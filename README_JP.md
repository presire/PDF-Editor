# PDF編集ツール - ビジュアルエディタ

> ブラウザで完結するセキュアなビジュアルPDFページ編集アプリケーション

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)  
[![PDF.js](https://img.shields.io/badge/PDF.js-v3.11-red)](https://mozilla.github.io/pdf.js/)  
[![pdf-lib](https://img.shields.io/badge/pdf--lib-latest-orange)](https://pdf-lib.js.org/)  

## 目次

- [概要](#概要)
- [主な機能](#主な機能)
- [ファイル構成](#ファイル構成)
- [セットアップ](#セットアップ)
- [使用方法](#使用方法)
  - [PDFファイルの読み込み](#pdfファイルの読み込み)
  - [ページの移動](#ページの移動)
  - [ページのコピー](#ページのコピー)
  - [ページの削除](#ページの削除)
  - [ページの拡大表示](#ページの拡大表示)
  - [編集済みPDFのダウンロード](#編集済みpdfのダウンロード)
- [技術仕様](#技術仕様)
- [ブラウザ互換性](#ブラウザ互換性)
- [セキュリティについて](#セキュリティについて)
- [トラブルシューティング](#トラブルシューティング)
- [FAQ](#faq)
- [ライセンス](#ライセンス)

## 概要

このツールは、Webブラウザ上で動作するビジュアルPDFページ編集アプリケーションです。  
2つのPDFファイルを並べて読み込み、ページを自由に移動、コピー、削除できます。サーバへのアップロードが不要で、クライアント側で完結するため、セキュアな環境でPDFファイルを編集できます。

### 特徴

- 🔒 **完全クライアントサイド**: ファイルがサーバーに送信されることはなく、すべてブラウザ内で処理されます
- 👁️ **ビジュアルインターフェース**: すべてのページをサムネイル表示して直感的に編集
- 🔄 **デュアルPDFパネル**: 2つのPDFを同時に読み込んで操作可能
- 🖱️ **ドラッグ&ドロップ**: ページの並べ替えやPDF間のコピーがスムーズ
- 🎯 **コンテキストメニュー**: ページを右クリックして素早く操作
- 🔍 **ページプレビュー**: 任意のページをクリックして拡大表示
- 📊 **進捗表示**: PDF生成時にリアルタイムで進捗バーを表示
- 🚀 **高速処理**: pdf-libとPDF.jsによる効率的なPDF操作

## 主な機能

### ビジュアルページ管理
- ✅ すべてのページをサムネイル表示
- ✅ ドラッグ&ドロップでPDF内のページ順序を変更
- ✅ ドラッグ&ドロップでPDF間でページをコピー
- ✅ ドラッグ操作時のビジュアルフィードバック
- ✅ クリックで任意のページを拡大表示

### ページ操作
- ✅ **ページ移動**: 同じPDF内でページをドラッグして並べ替え
- ✅ **ページコピー**: あるPDFから別のPDFへページをドラッグしてコピー
- ✅ **ページ削除**: 右クリックメニューまたは専用ボタンで削除
- ✅ **バッチ操作**: 複数ページを一度に処理

### ユーザーインターフェース
- ✅ 左右並列のデュアルPDFパネル
- ✅ ドラッグ&ドロップでファイル読み込み
- ✅ ページ拡大表示用のモーダルウィンドウ
- ✅ キャンセル機能付きの進捗バー
- ✅ リアルタイムステータスメッセージ
- ✅ キーボードショートカット（ESCキーで操作キャンセル）

### ファイル管理
- ✅ 編集済みPDFを個別にダウンロード
- ✅ 元のファイルは変更されない
- ✅ 自動ファイル名生成
- ✅ 大きなPDFにも対応（進捗表示付き）

## ファイル構成

```
📁 プロジェクトルート
├── 📄 PDF-Editor.html           # メインHTMLファイル
├── 📄 README_JP.md              # このファイル
├── 📁 css/
│   ├── 📄 PDF-Editor.css        # Custom styles
│   └── 📄 tailwind.css          # Custom styles
├── 📁 js/
│   ├── 📄 pdf.min.js            # PDF.jsライブラリ（レンダリング用）
│   ├── 📄 pdf-lib.min.js        # pdf-libライブラリ（操作用）
│   └── 📄 PDF-Editor.js         # メインアプリケーションロジック
└── 📁 img/
    └── 📄 (スクリーンショット)  # 使用例のスクリーンショット
```

### 各ファイルの説明

#### `PDF-Editor.html`
メインのHTMLファイル。アプリケーション構造、デュアルパネルレイアウト、モーダルウィンドウ、進捗オーバーレイが含まれています。

#### `css/PDF-Editor.css`
カスタムスタイルシート。デュアルパネルインターフェース、ページサムネイル、ドラッグ&ドロップフィードバック、モーダルウィンドウ、進捗バーのビジュアルデザインを提供します。

#### `js/PDF-Editor.js`
メインアプリケーションロジック。以下の機能が含まれています：
- PDFの読み込みとレンダリング
- ドラッグ&ドロップ機能
- ページ操作（移動、コピー、削除）
- 進捗追跡付きのPDF生成
- イベント処理とユーザーインタラクション

#### `js/pdf.min.js`
PDF.jsライブラリ。サムネイル表示のためにPDFページをcanvas要素としてレンダリングします。

#### `js/pdf-lib.min.js`
pdf-libライブラリ。PDFドキュメントの読み込み、変更、保存などのPDF操作を提供します。

## セットアップ

### 必要な環境

- モダンなWebブラウザ
  - **推奨**: Chrome 90+、Edge 90+、Opera 76+
  - **対応**: Firefox 88+
  - **制限付き**: Safari（互換性の問題がある場合があります）

### インストール手順

1. **ファイルのダウンロード**
   
   すべてのファイルをダウンロードし、以下のフォルダ構造を保持してください。

2. **ファイル配置**
   
   ```
   your-folder/
   ├── PDF-Editor.html
   ├── css/
   │   └── PDF-Editor.css
   ├── js/
   │   ├── pdf.min.js
   │   ├── pdf-lib.min.js
   │   └── PDF-Editor.js
   └── img/
       └── (スクリーンショット)
   ```

3. **ブラウザで開く**
   
   `PDF-Editor.html` をダブルクリックするか、ブラウザにドラッグ&ドロップしてください。

> **注意**:  
> ローカルファイルとして開く場合、一部のブラウザでファイル選択機能に制限がある場合があります。  
> その場合は、簡易的なHTTPサーバーを使用してください。

```bash
# Pythonの簡易HTTPサーバーを使用する例
python -m http.server 8000
# ブラウザで http://localhost:8000/PDF-Editor.html にアクセス
```

### 外部ライブラリの読み込み

アプリケーションは以下のライブラリをCDNから自動的に読み込みます：
- PDF.js worker: `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js`

オフラインで使用する場合は、これらのライブラリをダウンロードしてJavaScriptファイル内のURLを更新してください。

## 使用方法

### PDFファイルの読み込み

#### 左側パネル（パネルL）
1. 左側パネルの**「ファイルを選択」**ボタンをクリック、またはアップロードエリアにPDFファイルをドラッグ&ドロップ
2. PDFが読み込まれ、ページのサムネイルが表示されます
3. パネル上部にファイル情報が表示されます

#### 右側パネル（パネルR）
1. 右側パネルの**「ファイルを選択」**ボタンをクリック、またはアップロードエリアにPDFファイルをドラッグ&ドロップ
2. PDFが読み込まれ、ページのサムネイルが表示されます
3. 両方のPDFを個別に編集できるようになります

### ページの移動

**同じPDF内での移動：**
1. ページのサムネイルをクリックして押し続ける
2. 同じパネル内の目的の位置にドラッグ
3. マウスを離してページを並べ替える
4. プレビューラインが挿入位置を示します

**結果**: 同じPDFドキュメント内でページが並べ替えられます。

### ページのコピー

**異なるPDF間でのコピー：**
1. 一方のパネル（例：左側パネル）のページサムネイルをクリックして押し続ける
2. もう一方のパネル（例：右側パネル）の位置にドラッグ
3. マウスを離してページをコピー
4. 元のページはソースPDFに残ります

**結果**: ページが宛先PDFにコピーされ、元のページは変更されません。

### ページの削除

**方法1: コンテキストメニュー**
1. 任意のページサムネイルを右クリック
2. コンテキストメニューから**「🗑️ ページを削除」**を選択
3. ページが即座に削除されます

**方法2: 削除ボタン**
1. ページサムネイルをクリックして選択
2. 削除オプションを使用（UIに実装されている場合）

> **注意**: PDFには最低1ページが必要です。すべてのページを削除することはできません。

### ページの拡大表示

**拡大表示：**
1. 任意のページサムネイルをクリック
2. モーダルウィンドウが開き、ページが拡大表示されます
3. 上部にページ番号と総ページ数が表示されます
4. **✕**ボタンをクリック、またはモーダルの外側をクリックして閉じます

### 編集済みPDFのダウンロード

**左側PDF：**
1. 左側パネル下部の**「💾 左側のPDFをダウンロード」**ボタンをクリック
2. 生成進捗を示す進捗バーが表示されます
3. **「✕ キャンセル (ESC)」**をクリック、またはESCキーを押して操作をキャンセルできます
4. 完了すると、編集済みPDFが自動的にダウンロードされます

**右側PDF：**
1. 右側パネル下部の**「💾 右側のPDFをダウンロード」**ボタンをクリック
2. 左側PDFと同じプロセスに従います

> **注意**: ダウンロードボタンは、PDFが読み込まれた後にのみ有効になります。

### キーボードショートカット

- **ESC**: PDF生成をキャンセル、またはモーダルウィンドウを閉じる
- **右クリック**: ページサムネイルのコンテキストメニューを開く

## 技術仕様

### 使用技術

| 技術 | バージョン | 用途 |
|------|----------|------|
| HTML5 | - | ページ構造とマークアップ |
| CSS3 | - | スタイリングとアニメーション |
| JavaScript (ES6+) | - | アプリケーションロジック |
| PDF.js | v3.11 | PDFレンダリングとプレビュー |
| pdf-lib | 最新版 | PDF操作と生成 |
| Canvas API | - | ページサムネイルのレンダリング |

### 処理の仕組み

#### PDF読み込み
1. ユーザーがファイル入力またはドラッグ&ドロップでPDFファイルを選択
2. FileReader APIを使用してファイルをメモリに読み込み
3. PDF.jsが各ページをパースしてcanvas要素としてレンダリング
4. サムネイルが生成されてパネルに表示
5. pdf-libが操作のためにPDFを読み込み

#### ページ移動（同じPDF内）
1. ユーザーがページサムネイルを新しい位置にドラッグ
2. JavaScriptがドラッグ操作とターゲット位置を追跡
3. ドロップ時にページ順序配列が更新
4. UIが新しい順序を反映して更新
5. ダウンロードまでPDFは再生成されない

#### ページコピー（PDF間）
1. ユーザーが一方のパネルから別のパネルにページをドラッグ
2. pdf-libドキュメントからソースページデータを取得
3. ページが宛先PDFのページ配列にコピー
4. 宛先パネルのUIが新しいページで更新
5. ソースPDFは変更されない

#### ページ削除
1. ユーザーがページを右クリックして削除を選択
2. ページがページ配列から削除
3. 最低1ページが残るよう検証
4. UIが即座に更新
5. ダウンロードまでPDFは再生成されない

#### PDF生成
1. ユーザーがダウンロードボタンをクリック
2. ページ数情報付きの進捗バーが表示
3. pdf-libを使用して新しいPDFドキュメントを作成
4. ページが1つずつコピーされ、進捗が更新
5. 各ページのコピーで進捗バーが更新
6. 完成したPDFがBlobに変換
7. ブラウザのダウンロードAPIを使用してBlobをダウンロード
8. 完了時に進捗バーが消える

### ファイルサイズ制限

- **推奨最大サイズ**: 1つのPDFあたり50MB
- **理論上の最大サイズ**: ブラウザのメモリに依存
- **注意**: 大きなPDFは読み込みと処理に時間がかかる場合があります

### 対応するPDFバージョン

- PDF 1.3〜1.7
- PDF 2.0（一部機能）

### ページ数の制限

- **最小ページ数**: 1ページ（削除後も最低1ページは残ります）
- **最大ページ数**: 制限なし（ただしブラウザのメモリに依存）

### パフォーマンスの考慮事項

- **サムネイル生成**: ページ数が多いPDFでは時間がかかる場合があります
- **ドラッグ操作**: スムーズなパフォーマンスに最適化
- **PDF生成**: 進捗バーで監視とキャンセルが可能
- **メモリ使用量**: PDFサイズとページ数に応じて増加

## ブラウザ互換性

### 完全対応ブラウザ

✅ **Google Chrome 90+**
- すべての機能が完全対応
- 最適なパフォーマンス
- Canvasレンダリングのハードウェアアクセラレーション対応

✅ **Microsoft Edge 90+**
- すべての機能が完全対応
- Chromiumベース、Chromeと同等のパフォーマンス

✅ **Opera 76+**
- すべての機能が完全対応
- Chromiumエンジンベース

### 部分対応ブラウザ

⚠️ **Firefox 88+**
- すべてのコア機能が対応
- ドラッグ&ドロップの動作が若干異なる場合あり
- ローカルテストではCORS設定が必要な場合あり

⚠️ **Safari**
- 基本機能は動作
- 大きなPDFでパフォーマンスの問題が発生する場合あり
- 一部のCSSアニメーションが異なる場合あり

### 動作確認済み環境

- Google Chrome 120以降
- Microsoft Edge 120以降
- Opera 105以降
- Firefox 120以降

## セキュリティについて

### セキュリティの特徴

✅ **クライアントサイド処理**
- すべてのPDF編集処理はブラウザ内で完結
- PDFファイルがサーバーに送信されることはありません
- インターネット接続なしでも動作可能（ローカルで完結）

✅ **プライバシー保護**
- ファイルの内容を外部に送信しません
- ブラウザのメモリ上でのみ処理
- ページを閉じるとすべてのデータがクリアされます

✅ **データの完全性**
- 元のPDFファイルは変更されません
- 編集後のPDFは新しいファイルとして保存されます
- 元のPDF品質を保持します

✅ **外部依存なし**
- すべての処理がローカルで実行
- サードパーティサービスを使用しません
- トラッキングや分析なし

### セキュリティのベストプラクティス

#### 1. バックアップの作成
編集前に必ず元のPDFファイルのバックアップを取ってください。

#### 2. 信頼できる環境での使用
- 公共のコンピューターでの使用は避けてください
- マルウェア対策ソフトウェアを最新の状態に保ってください
- 信頼できるブラウザを使用してください

#### 3. ファイルの確認
編集後のPDFファイルを開いて、意図した通りに編集されているか確認してください。

#### 4. ブラウザキャッシュのクリア
機密性の高いPDFを扱った後は、ブラウザのキャッシュと履歴をクリアすることを検討してください。

### セキュリティの制限事項

⚠️ **注意すべき点**

1. **ブラウザのセキュリティ**
   - ブラウザ拡張機能がデータにアクセスできる可能性があります
   - キーロガーやマルウェアからは保護されません

2. **メモリ上のデータ**
   - 処理中はメモリ上にPDFデータが存在します
   - ページを閉じるか他のページに移動するとクリアされます

3. **保護されたPDF**
   - パスワード保護されたPDFは開けません
   - 編集制限のあるPDFは正常に処理できない場合があります

4. **メタデータ**
   - 一部のメタデータが編集時に失われる場合があります
   - フォームフィールドや注釈が保持されない場合があります

## トラブルシューティング

### よくある問題と解決方法

#### ❌ 「エラーが発生しました」と表示される

**原因と解決方法：**

1. **PDFファイルが破損している**
   - 別のPDFビューアで開けるか確認
   - 可能であれば、PDFを再生成

2. **保護されたPDF**
   - パスワードを解除してから再試行
   - 編集権限があるか確認

3. **ファイルサイズが大きすぎる**
   - 1ファイルあたり50MB以下を推奨
   - 大きなファイルは処理前に分割

4. **ブラウザのメモリ不足**
   - 他のタブを閉じる
   - ブラウザを再起動
   - より多くのメモリを搭載したPCを使用

#### ❌ ページが正しく表示されない

**解決方法：**
- ブラウザページを更新
- PDFを再度読み込み
- ブラウザコンソールでエラーメッセージを確認（F12）

#### ❌ ドラッグ&ドロップが機能しない

**解決方法：**
- JavaScriptが有効になっているか確認
- 最良の互換性のためにChromeまたはEdgeを使用
- ファイルが有効なPDFであるか確認

#### ❌ ページを削除できない

**説明：**  
これは意図的な動作です。PDFファイルは最低1ページ必要なため、最後の残りページを削除することはできません。

**解決方法：**  
少なくとも1ページはPDFに残してください。

#### ❌ PDF生成が遅い

**解決方法：**
- ページ数が多い大きなPDFでは正常な動作です
- 進捗バーを使用して進捗を監視
- 必要に応じてキャンセルしてPDFを分割

#### ❌ ダウンロードボタンが無効になっている

**解決方法：**
- PDFファイルが読み込まれているか確認
- PDFが正常に読み込まれたか確認（サムネイルが表示されているはず）

### デバッグ方法

問題が解決しない場合、ブラウザの開発者ツールで詳細を確認：

1. **F12キー**を押して開発者ツールを開く
2. **Console**タブを選択
3. エラーメッセージを確認
4. 赤色のエラーメッセージや警告を探す

## FAQ

### Q1: このツールは安全ですか？

**A:**  
はい、安全です。すべての処理がブラウザ内で完結し、PDFファイルがインターネット上に送信されることはありません。ただし、信頼できる環境（自分のPC、信頼できるブラウザ）で使用することを推奨します。

### Q2: インターネット接続は必要ですか？

**A:**  
部分的に必要です。初回読み込み時にCDNからPDF.js workerを取得するためにインターネットが必要です。ただし、すべてのライブラリをローカルにダウンロードしてURLを更新すれば、完全にオフラインで動作できます。

### Q3: どのくらい大きなPDFファイルを処理できますか？

**A:**  
ブラウザのメモリに依存しますが、1つのPDFあたり50MB以下を推奨します。それより大きいファイルは処理に時間がかかるか、メモリ不足でエラーになる可能性があります。

### Q4: 元のPDFファイルは変更されますか？

**A:**  
いいえ、変更されません。編集後のPDFは新しいファイルとして保存され、元のファイルはそのまま残ります。

### Q5: 2つ以上のPDFを扱えますか？

**A:**  
現在のバージョンでは一度に2つのPDFに対応しています。より多くのファイルを扱うには、編集をダウンロードした後に別のPDFを読み込むことができます。

### Q6: モバイルデバイスでも使えますか？

**A:**  
アプリケーションはモバイルデバイスでも読み込めますが、ドラッグ&ドロップ機能と全体的なユーザーエクスペリエンスはデスクトップ用に最適化されています。マウスまたはトラックパッドの使用を推奨します。

### Q7: PDFの品質は劣化しますか？

**A:**  
基本的に劣化しません。pdf-libは元のPDF品質を保持しますが、一部のメタデータ、フォーム、注釈が処理中に失われる可能性があります。

### Q8: パスワード保護されたPDFは編集できますか？

**A:**  
いいえ、できません。パスワード保護や編集制限のあるPDFは、まず保護を解除してから編集してください。

### Q9: 商用利用は可能ですか？

**A:**  
はい、可能です。MITライセンスの下で配布されているため、商用・非商用問わず自由に使用できます。

### Q10: PDF内のページ順序を変更するにはどうすればよいですか？

**A:**  
同じパネル内でページサムネイルをドラッグ&ドロップするだけです。ドロップした位置に基づいてページが並べ替えられます。

### Q11: 操作を取り消すことはできますか？

**A:**  
現在のバージョンには取り消し機能がありません。変更を元に戻すには、単に元のPDFファイルを再読み込みしてください。変更はダウンロードボタンをクリックするまで保存されないことを覚えておいてください。

### Q12: ダウンロード時に進捗バーが表示されるのはなぜですか？

**A:**  
PDF生成には時間がかかることがあり、特に大きなファイルの場合はそうです。進捗バーは何ページが処理されたかを示し、必要に応じてキャンセルすることができます。これにより、ブラウザがフリーズしているように見えるのを防ぎます。

### Q13: PDF生成中にブラウザを閉じるとどうなりますか？

**A:**  
操作が中断され、ファイルはダウンロードされません。元のPDFは変更されません。ページを再読み込みして再試行できます。

## ライセンス

```
MIT License

Copyright (c) 2025 Presire

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

## 🔗 関連リンク

- [PDF.js Documentation](https://mozilla.github.io/pdf.js/)
- [pdf-lib Documentation](https://pdf-lib.js.org/)
- [MDN Web Docs - Drag and Drop API](https://developer.mozilla.org/ja/docs/Web/API/HTML_Drag_and_Drop_API)
- [MDN Web Docs - Canvas API](https://developer.mozilla.org/ja/docs/Web/API/Canvas_API)
- [MDN Web Docs - PDF](https://developer.mozilla.org/ja/docs/Glossary/PDF)

---

**最終更新**: 2025年12月  
**バージョン**: 2.0（ビジュアルエディタ）  
